---
layout: main
title: MOTECH - Mobile Technology for Community Health
---

<div class="column-container clearfix">

  {% include modules/navigation.incl %}

  <div class="column five-sixths">
    <h3>IVR Voxeo Module</h3> 

    <h4>Description</h4> 
	<p>IVR Voxeo is an implementation specific module that provides IVR service by utilizing
 	Voxeo's IVR server. The Voxeo module tracks the progress of both incoming and outgoing phone calls 
	and stores that information in a CouchDB repository. Events are published to indicate call results. 
	Listeners may subscribe to these events and handle them in an implementation specific fashion.</p>

    <h4>Information for implementation</h4> 

	<p>The Voxeo module provides a concrete implementation of the IVR module's IVRService. Implementers can use the the Voxeo module to accomplish the following:</p>
	<ul>
		<li>Initiate a call to a phone number with specified content.</li>
		<li>Track the progress of incoming and outgoing calls.</li>
	</ul>

    <h4>Initiating Calls</h4>
	<p>In order to use the Voxeo module's IVR implementation, the service bean voxeoIvrService must 
	be injected into the calling class. See the IVR module for more information about the IVRService contract and CallRequest objects.</p>


	<h4>Call State</h4><p>
	The state of the call is stored in CouchDB as the call progresses, for both incoming and outgoing phone calls. 
	Each call is stored as a single document in the CouchDB repository that is updated when status changes are 
	sent back to MoTeCH from Voxeo's server. Below are two examples of phone calls and their progress.</p>

	<p><b>Incoming Call example:</b></p>
	<img src="/assets/modules/incomingcall.PNG"/>
	<p><dd>
	<em><b>_id</b></em>:  Same as the call's sessionId (from Voxeo).<br /></dd></p>

	<p><dd>
	<em><b>_rev</b></em>: The revision identity of the document.<br /></dd></p>
	
	<p><dd>
	<em><b>answerDate</b></em>: The date that the call connection was established by Voxeo's server.<br /></dd></p>

	<p><dd>
	<em><b>callRequest</b></em>: The call request object associated with this PhoneCall. For incoming calls, this is unused.<br /></dd></p>

	<p><dd>
	<em><b>direction</b></em>: Denotes the direction of the call, in this case, it is an incoming call.<br /></dd></p>

	<p><dd>
	<em><b>disposition</b></em>: The call's disposition, in this case, the call was answered.<br /></dd></p>

	<p><dd>
	<em><b>duration</b></em>: The duration of the call, in seconds. This call lasted ten seconds.<br /></dd></p>

	<p><dd>
	<em><b>endDate</b></em>: The end date of the call.<br /></dd></p>

	<p><dd>
	<em><b>events</b></em>: Events that correspond to changes in the status of the call. 
		<ul>
		<li><em>DISCONNECTED</em>: Either endpoint terminated the call.</li>
		<li><em>ALERTING</em>: Voxeo's server-side CCXML recognized an incoming call.</li>
		<li><em>CONNECTED</em>: The call was accepted and a valid connection was made.</li>
		<li><em>DIALOG_STARTED</em>: Voice dialog has begun.</li>
		<li><em>DIALOG_EXIT</em>: Voice dialog has ended.</li>
		</ul>
	
	<p><dd>
	<em><b>sessionId</b></em>: The server side Voxeo sessionId associated with the call.<br /></dd></p>

	<p><dd>
	<em><b>startDate</b></em>: The date that Voxeo's server recognized this as an incoming call.<br /></dd></p>

	<p><dd>
	<em><b>type</b></em>: The type of record that the Couch document is. In this case, it is a PhoneCall object from the Voxeo module.<br /></dd></p>

	<br />
	<br />

	<p><b>Outgoing Call example:</b></p><br />
	<img src="/assets/modules/outgoingcall.PNG"/>

	<p><dd>
	<em><b>_id</b></em>: Generated by couchDB.<br /></dd></p>

	<p><dd>
	<em><b>_rev</b></em>: The revision identity of the document.<br /></dd></p>

	<p><dd>
	<em><b>answerDate</b></em>: The date that the call connection was established by Voxeo's server.<br /></dd></p>

	<p><dd>
	<em><b>callRequest</b></em>: The CallRequest object associated with this call. See the IVR platform module documentation for more information on CallRequests.<br /></dd></p>

	<p><dd>
	<em><b>direction</b></em>: Denotes the direction of the call, in this case, it is an outgoing call.<br /></dd></p>

	<p><dd>
	<em><b>disposition</b></em>: The call's disposition, in this case, the call was answered.<br /></dd></p>

	<p><dd>
	<em><b>duration</b></em>: The duration of the call, in seconds. This call lasted twenty seconds.<br /></dd></p>

	<p><dd>
	<em><b>endDate</b></em>: The end date of the call.<br /></dd></p>

	<p><dd>
	<em><b>events</b></em>: Events that correspond to changes in the status of the call. 
		<ul>
		<li><em>PROGRESSING</em>: The outbound call has not yet been answered, but it is in progress.</li> 
		<li><em>CONNECTED</em>: The call was accepted and a valid connection was made.</li>
		<li><em>DIALOG_STARTED</em>: Voice dialog has begun.</li>
		<li><em>DISCONNECTED</em>: Either endpoint terminated the call.</li>
		<li><em>DIALOG_EXIT</em>: Voice dialog has ended.</li></dd></p>
		</ul>

	<p><dd>
	<em><b>startDate</b></em>: The date that the Voxeo module's IVRService was invoked to place the call.<br /></dd></p>

	<p><dd>
	<em><b>type</b></em>: The type of record that the Couch document is. In this case, it is a PhoneCall object from the Voxeo module.<br /></dd></p>

	<br />

	<h4>Events</h4>
	<p>Events are raised when particular call results occur. These events can be customized for a particular 
	CallRequest. The events are for on success, on busy, on no answer, and on failure. 
	If implementers wish to use these events, they must set each event for the specified 
	CallRequest. Implementers should define these events, include them in the CallRequest, 
	and then write custom listeners for application specific logic for these call results.</p></br>

	<p><b><em>Flow of control and events in the IVR Voxeo module and Voxeo's server:</em></b></p>

	<img class="five-sixths" src="/assets/modules/callinglogic.png"/>

	<h4>Voxeo server side</h4>

	<p>The Voxeo module makes a request, by token ID, to the Voxeo server. Implementers must ensure that the request
	 is directed to their Voxeo account. Currently, this requires changing the token ID in the VoxeoIVRService class of the Voxeo module.
	An accompanying CCXML document on Voxeo's server side is responsible for the back-and-forth communication 
	between the MoTeCH server and Voxeo server. This document can be generated using the Voxeo module's CcxmlController.</p>

	<p>An accompanying ccxml document on Voxeo's server side is responsible for the back and forth 
	communication between the Motech server and Voxeo server. This document can be generated using the Voxeo module's CcxmlController.</p>

	<h4>Content</h4>
	<p>Content is associated with a VXML URI. This can be a relative 
	path or a full URI. Nested audio content pointing to MoTeCH CMSLite URI's can be included in the VXML file.</p>
  </div>
 </div>
