---
layout: main
title: MOTECH - Mobile Technology for Community Health
---

<div class="column-container clearfix">

  {% include modules/navigation.incl %}

  <div class="column five-sixths">
    <h3> Module</h3> 

    <h4>Description</h4> 
<p>IVR Voxeo is an implementation specific module that provides IVR service by utilizing Voxeo's IVR server. The Voxeo module tracks the progress of both incoming and outgoing phone calls and stores that information in a CouchDB repository. Events are published to indicate call results. Listeners may subscribe to these events and handle them in an implementation specific fashion.</p>

    <h4>Information for implementation</h4> 

<p>The Voxeo module provides a concrete implementation of the IVR module's IVRService. Implementers can use the module to accomplish the following:
</p>
<ul>
<li>Initiate a call to a phone number with specified content</li>
<li>Track the progress of incoming and outgoing calls</li>
</ul>
    <h4>Initiating Calls</h4>
<p>In order to use the Voxeo module's IVR implementation, the service bean ivrService must be injected into the calling class. See the IVR module for more information about the IVRService contract and CallRequest objects.</p>


<h4>Call State</h4><p>
The state of the call is stored in CouchDB as the call progresses, for both incoming and outgoing phone calls. Each call is stored as a single document in the CouchDB repository that is updated when status changes are sent back to MoTeCH from Voxeo's server. Below are two examples of phone calls and their progress.</p>

<p><i>Incoming Call example:</i></p>
<img src="/assets/modules/incomingcall.PNG"/>
<em>_id</em>: Same as the call's sessionId (from Voxeo)<br />
<em>_rev</em>: The revision identify of the document<br />
<em>answerDate</em>: The date that the call connection was established by Voxeo's server<br />
callRequest: The call request object associated with this PhoneCall. For incoming calls, this is unused<br />
<em>direction</em>: Denotes the direction of the call, in this case, it is an incoming call<br />
<em>disposition</em>: The call's disposition, in this case, the call was answered.<br />
<em>duration</em>: The duration of the call, in seconds. This call lasted ten seconds.<br />
<em>endDate</em>: The end date of the call.<br />
<em>events</em>: Events that correspond to changes in the status of the call. When the call was incoming, an ALERTING status event was raised by Voxeo's server side CCXML. When the call is accepted and a valid connection is made, the CONNECTED status is raised. When voice dialog starts, DIALOG_STARTED is raised, when the dialog ends, DIALOG_EXIT is raised. When either side has ended the call, a DISCONNECTED event is raised.<br />
<em>sessionId</em>: The server side Voxeo sessionId associated with the call<br />
startDate: The date that Voxeo's server recognized this as an incoming call.<br />
<em>type</em>: The type of record that the Couch document is. In this case, it is a PhoneCall object from the Voxeo module.<br />
<br />
<br />
<em>An outgoing call:</em><br />
<img src="/assets/modules/outgoingcall.PNG"/>
<em>_id</em>: Generated by couchDB<br />
<em>_rev</em>: The revision identify of the document<br />
<em>answerDate</em>: The date the<br />
<em>callRequest</em>: The CallRequest object associated with this call. See the IVR platform module documentation for more information on CallRequests.<br />
<em>direction</em>: Denotes the direction of the call, in this case, it is an outgoing call<br />
<em>disposition</em>: The call's disposition, in this case, the call was answered.<br />
<em>duration</em>: The duration of the call, in seconds. This call lasted ten seconds.<br />
<em>endDate</em>: The end date of the call.<br />
<em>events</em>: Events that correspond to changes in the status of the call. When the call was incoming, an ALERTING status event was raised by Voxeo's server side CCXML. When the call is accepted and a valid connection is made, the CONNECTED status is raised. When voice dialog starts, DIALOG_STARTED is raised, when the dialog ends, DIALOG_EXIT is raised. When either side has ended the call, a DISCONNECTED event is raised.<br />
<em>startDate</em>: The date that the Voxeo module's IVRService was invoked to place the call.<br />
<em>type</em>: The type of record that the Couch document is. In this case, it is a PhoneCall object from the Voxeo module.<br />
<br />

<h3>Events</h3>
<p>Events are raised when particular call results occur. These events can be customized in the CallRequest. The events are for on success, on busy, on no answer and on failure. An implementer may define these events and include them in the CallRequest, then write custom listeners for application specific logic for these call results.</p>
</br>
<em>Flow of control and events in the IVR Voxeo module and Voxeo's server:</em>
<img src="/assets/modules/callinglogic.png"/>
<h3>Voxeo server side</h3>
<p>
The Voxeo module makes a request, by token ID, to the Voxeo server. Implementers must ensure that the request is directed to their Voxeo account. Currently this requires changing the token ID in the IVRServiceImpl class of the Voxeo module.
</p>
<p>
An accompanying ccxml document on Voxeo's server side is responsible for the back and forth communication between the Motech server and Voxeo server. This document can be generated using the Voxeo module's CcxmlController.
</p>
<h3>Content</h3>
<p>Content is associated with a vxml URI. This can be a relative path or a full URI. Nested audio content pointing to MoTeCH CMSLite URI's can be included in the vxml file.</p>
  </div>
 </div>
